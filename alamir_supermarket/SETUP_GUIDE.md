# ๐ฑ ุณูุจุฑ ูุงุฑูุช ุงูุฃููุฑ - ุฏููู ุงูุฅุนุฏุงุฏ ูุงูุชุทููุฑ

## ๐ฅ Firebase Setup

### Collections ุงููุทููุจุฉ ูู Firestore:

#### 1. **users** Collection
```json
{
  "id": "uid123",
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "phone": "01012345678",
  "email": "ahmed@example.com",
  "role": "customer",  // ุฃู "admin" ุฃู "owner"
  "addresses": [
    "ุงููุนุงุฏูุ ุงููุงูุฑุฉ",
    "ุงูุฌูุฒุฉุ ุงููุงูุฑุฉ"
  ],
  "profileImage": "https://...",
  "isActive": true,
  "createdAt": Timestamp,
  "lastLogin": Timestamp
}
```

---

#### 2. **categories** Collection
```json
{
  "id": "cat_001",
  "name": "ุฎุถุงุฑ ูููุงูู",
  "image": "https://...",
  "createdAt": Timestamp
}
```

**ุฃูุซูุฉ Categories:**
- ุฎุถุงุฑ ูููุงูู
- ุจูุงูุฉ
- ุฃูุจุงู ูุฌุจูุฉ
- ูุดุฑูุจุงุช
- ุชูุธูู ูููุธูุงุช

---

#### 3. **products** Collection
```json
{
  "id": "prod_001",
  "name": "ุทูุงุทู ุญูุฑุงุก",
  "description": "ุทูุงุทู ุทุงุฒุฉ ุนุงููุฉ ุงูุฌูุฏุฉ",
  "price": 20.0,
  "oldPrice": 25.0,  // ุงุฎุชูุงุฑู - ูู ุญุงูุฉ ูุฌูุฏ ุฎุตู ุณุงุจู
  "image": "https://...",
  "images": [
    "https://...",
    "https://...",
    "https://..."
  ],
  "categoryId": "cat_001",
  "quantity": 50,  // ุงููููุฉ ุงููุนููุฉ (ูุง ูุฑุงูุง Customer)
  "isAvailable": true,
  "isFeatured": false,
  "rating": 4.5,  // ุงูุชูููู (1-5 ูุฌูู)
  "reviewCount": 23,
  "createdAt": Timestamp
}
```

---

#### 4. **orders** Collection
```json
{
  "id": "order_xyz",
  "userId": "uid123",
  "items": [
    {
      "productId": "prod_001",
      "productName": "ุทูุงุทู ุญูุฑุงุก",
      "productImage": "https://...",
      "price": 20.0,
      "quantity": 3
    }
  ],
  "totalPrice": 60.0,
  "status": "pending",  // pending, preparing, shipped, delivered, cancelled
  "customerName": "ุฃุญูุฏ ูุญูุฏ",
  "customerPhone": "01012345678",
  "address": "ุงููุนุงุฏูุ ุงููุงูุฑุฉ",
  "notes": "ุงุถูููุง ูู ุดูุทุฉ ูููุฉ",
  "createdAt": Timestamp,
  "deliveryTime": Timestamp  // ุงุฎุชูุงุฑู
}
```

---

## ๐ Firebase Security Rules

ุชู ุฅูุดุงุก ููู **FIREBASE_SECURITY_RULES.txt** ูุญุชูู ุนูู ุงูููุงุนุณ ุงูุฃูููุฉ ุงููุงููุฉ.

**ุงูุฎุทูุงุช:**
1. ุงุฐูุจ ุฅูู [Firebase Console](https://console.firebase.google.com)
2. ุงุฎุชุฑ Project: **market-8c0f1**
3. ุงุฐูุจ ุฅูู Firestore โ Rules
4. ุงูุณุฎ ูุญุชูู `FIREBASE_SECURITY_RULES.txt` ูุงูุตูู ูู ุงูู Rules Editor
5. ุงุถุบุท Publish

---

## ๐ค ูุธุงู ุงูู Roles ูุงูุตูุงุญูุงุช

### 1. **Customer** (ุงูุนููู)
- ุชุณูู ูุฅุถุงูุฉ ููุณูุฉ
- ุนุฑุถ ุงูููุชุฌุงุช ูุงููุฆุงุช
- ุฅูุดุงุก ุทูุจุงุช
- ุชุชุจุน ุทูุจุงุชู ููุท
- ุฑุคูุฉ ุญุงูุฉ ุงูุชููุฑ (ูุชุงุญ/ุบูุฑ ูุชุงุญ) **ููุท** - ูุง ูุฑู ุงููููุฉ ุงูุฏูููุฉ
- ุชูููู ุงูููุชุฌุงุช (ุจุนุฏ ุงูุดุฑุงุก)

### 2. **Admin** (ุงููุฏูุฑ/ุงูููุธู)
- ุนุฑุถ **ูู** ุงูุทูุจุงุช
- ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ (pending โ preparing โ shipped โ delivered)
- ุชุญุฏูุซ ุญุงูุฉ ุงูููุชุฌ (ูุชุงุญ/ุบูุฑ ูุชุงุญ) **ููุท**
- **ูุง ูุฑู** ุงููููุงุช ุงูุฏูููุฉ ููููุชุฌุงุช
- **ูุง ูุถูู/ูุนุฏู/ูุญุฐู** ููุชุฌุงุช
- **ูุง ูุฑู** ูุฏููุนุงุช ุฃู ุฅุญุตุงุฆูุงุช

### 3. **Owner** (ุงููุงูู)
- ุฅุฏุงุฑุฉ **ูุงููุฉ** ููููุชุฌุงุช ูุงููุฆุงุช
- ุฑุคูุฉ **ุงููููุงุช ุงูุฏูููุฉ** ูููุฎุฒูู
- ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ูุงูุชุญูู ูููุง
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ูุงููุจูุนุงุช
- ุฅูุดุงุก Admin ุฌุฏุฏ
- ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงูุนููุงุก

---

## ๐ Session Persistence (ุจูุงุก ุงูุฌูุณุฉ)

ุนูุฏูุง ูุณุฌู ุงููุณุชุฎุฏู ุฏุฎูู:
1. ูุชู ุญูุธ ุงูุฌูุณุฉ **ุชููุงุฆููุง** ูู ูุจู Firebase Auth
2. ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู ููุชุญู ูุฑุฉ ุฃุฎุฑู:
   - `FirebaseAuth.instance.currentUser` ุณูููู ููุฌูุฏ
   - ุงูุชุทุจูู ุณููุฌูู ุฅูู ุงูุดุงุดุฉ ุงูููุงุณุจุฉ ุญุณุจ role

3. ุงูุชุณุฌูู ุงูุฎุฑูุฌ ููุณุญ ุงูุฌูุณุฉ **ููุงุฆููุง**

---

## ๐ ูููู ุงููุดุฑูุน ุงููุญุฏุซ

```
lib/
โโโ main.dart                           # Updated with AuthWrapper
โโโ firebase_options.dart               # Firebase config (ููุฌูุฏ ุจุงููุนู)
โโโ models/
โ   โโโ user_model.dart                # โ ูุญุฏุซ - ุฃุถููุง role ู attributes
โ   โโโ product_model.dart             # โ ูุญุฏุซ - ุฃุถููุง rating ู reviewCount
โ   โโโ order_model.dart               # ููุฌูุฏ ุจุงููุนู
โ   โโโ category_model.dart            # ููุฌูุฏ ุจุงููุนู
โ   โโโ cart_item.dart                 # ููุฌูุฏ ุจุงููุนู
โโโ services/
โ   โโโ auth_service.dart              # โ ูุญุฏุซ - Session persistence + role management
โ   โโโ product_service.dart           # ููุฌูุฏ ุจุงููุนู
โ   โโโ order_service.dart             # ููุฌูุฏ ุจุงููุนู
โ   โโโ cart_provider.dart             # ููุฌูุฏ ุจุงููุนู
โโโ screens/
    โโโ auth/
    โ   โโโ login_screen.dart          # โ ุฌุฏูุฏ - ุชุณุฌูู ุฏุฎูู ูุญุณูู
    โ   โโโ register_screen.dart       # โ ุฌุฏูุฏ - ุชุณุฌูู ูุน ุงุฎุชูุงุฑ role
    โโโ customer/
    โ   โโโ splash_screen.dart         # โ ูุญุฏุซ - ููุฌู ุญุณุจ role
    โ   โโโ home_screen.dart           # โ ูุญุฏุซ - ุฃุถููุง logout
    โ   โโโ cart_screen.dart           # ููุฌูุฏ ุจุงููุนู
    โ   โโโ orders_screen.dart         # ููุฌูุฏ ุจุงููุนู
    โ   โโโ profile_screen.dart        # ููุฌูุฏ ุจุงููุนู
    โ   โโโ product_detail_screen.dart # ููุฌูุฏ ุจุงููุนู
    โ   โโโ data_debug_screen.dart     # ููุฌูุฏ ุจุงููุนู
    โโโ owner/
    โ   โโโ owner_dashboard.dart       # โ ุฌุฏูุฏ - ููุญุฉ ุชุญูู ุงููุงูู
    โโโ admin/
        โโโ admin_dashboard.dart       # โ ุฌุฏูุฏ - ููุญุฉ ุชุญูู ุงููุฏูุฑ
```

---

## ๐ ุฎุทูุงุช ุงูุชุดุบูู

### 1. **ุฅุถุงูุฉ Collections ูู Firebase**
ุงุฐูุจ ุฅูู Firebase Console ูุฃุถู ุงูุจูุงูุงุช ุงูุชุงููุฉ:

```
collections/
โโโ users/
โ   โโโ <firebase_uid>  (ุณูููุดุฃ ุชููุงุฆููุง ุนูุฏ ุงูุชุณุฌูู)
โโโ categories/
โ   โโโ cat_001: ุฎุถุงุฑ ูููุงูู
โ   โโโ cat_002: ุจูุงูุฉ
โ   โโโ cat_003: ุฃูุจุงู
โ   โโโ ...
โโโ products/
โ   โโโ prod_001: ุทูุงุทู
โ   โโโ prod_002: ูุจู
โ   โโโ ...
โโโ orders/
    โโโ (ุณูููุดุฃ ุชููุงุฆููุง ุนูุฏ ุฅูุดุงุก ุทูุจ)
```

### 2. **ุชุทุจูู Security Rules**
ุงูุณุฎ ูุญุชูู `FIREBASE_SECURITY_RULES.txt` ุฅูู Firebase Console

### 3. **ุชุดุบูู ุงูุชุทุจูู**
```bash
flutter pub get
flutter run
```

---

## ๐ Flow ุงูุงุณุชุฎุฏุงู

### Customer (ุนููู ุนุงุฏู):
1. ููุชุญ ุงูุชุทุจูู
2. ูุฎุชุงุฑ "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ" + ูุฎุชุงุฑ "ุนููู"
3. ูููุฃ ุงูุจูุงูุงุช ููุณุฌู
4. ูููุฌู ุชููุงุฆููุง ูู HomeScreen
5. ูุชุณูู ููุถูู ููุณูุฉ
6. ููุดุฆ ุทูุจ
7. ูุชุงุจุน ุทูุจู
8. ุนูุฏ ุงูุฎุฑูุฌ ูุถุบุท logout

### Admin (ูุฏูุฑ):
1. ููุชุญ ุงูุชุทุจูู
2. ูุฎุชุงุฑ "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ" + ูุฎุชุงุฑ "ูุฏูุฑ"
3. (ูู ุงููุงูุน ุณูุชู ุฅูุดุงุก ุญุณุงุจ Admin ูู ูุจู Owner)
4. ูููุฌู ูู AdminDashboard
5. ูุฑู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ููุฑูุง (Realtime)
6. ูุญุฏุซ ุญุงูุฉ ุงูุทูุจ ูุงููุฎุฒูู

### Owner (ูุงูู):
1. ููุชุญ ุงูุชุทุจูู
2. ูุฎุชุงุฑ "ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ" + ูุฎุชุงุฑ "ูุงูู"
3. ูููุฌู ูู OwnerDashboard
4. ูุถูู/ูุนุฏู/ูุญุฐู ููุชุฌุงุช
5. ูุถูู Admin ุฌุฏุฏ
6. ูุฑู ุงูุฅุญุตุงุฆูุงุช ูุงููุจูุนุงุช

---

## ๐ Debugging & Testing

### ุชุดุบูู ูู Development Mode:
```bash
flutter run -d chrome  # ููู Web
flutter run -d emulator-5554  # ููู Android
```

### ุนุฑุถ Logs:
```bash
# ูู VSCode ุฃู Terminalุ ุณุชุฑู logs ูู Firestore ุนูุฏ:
# - ุฅูุดุงุก/ุชุญุฏูุซ/ุญุฐู ุจูุงูุงุช
# - ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ
# - ุงูุฃุฎุทุงุก ุงูุฃูููุฉ (Security Rule violations)
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงููููุงุช ุงูุฏูููุฉ ูุฎููุฉ ุนู ุงูุนููุงุก**: ูุฑูู ููุท "ูุชุงุญ" ุฃู "ุบูุฑ ูุชุงุญ"
2. **Realtime Updates**: ุนูุฏ ุชุนุฏูู Product ุฃู Order ูู Firebaseุ ูุญุฏุซ ููุฑูุง ูู ุงูุชุทุจูู
3. **Session Persistence**: ุชููุงุฆู ูู Firebase - ูุง ุชุญุชุงุฌ ููุนู ุดูุก
4. **Security**: ูุชู ูุฑุถ ุงูุตูุงุญูุงุช ูู ุฌุงูุจ Firestore ูุงูุชุทุจูู ูุนูุง

---

## ๐ ูููุฒูุฏ ูู ุงูุชุทููุฑ:

ุงููููุงุช ูุงูุดุงุดุงุช ุงูููุฌูุฏุฉ ุงูุขู ุฌุงูุฒุฉ ูู:
- โ Session Persistence
- โ 3 Roles ูุน ุตูุงุญูุงุช ูุฎุชููุฉ
- โ Realtime Updates ูู Firebase
- โ Security Rules ูุญููุฉ
- โณ ุชุทููุฑ ุชูุงุตูู ุงูู Owner ู Admin Panels (ูุฑูุจูุง)
- โณ ุชุทุจูู ุงูุฏูุฒุงูู ูู ุงูุตูุฑุฉ ุจุงููุงูู (ูุฑูุจูุง)
